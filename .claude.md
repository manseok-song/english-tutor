# AntiGravity - AI English Tutor for CEOs

> 운전 중인 40대 경영자를 위한 초저지연 AI 비즈니스 영어 튜터 PWA

## 프로젝트 개요

AntiGravity는 바쁜 테크 스타트업 CEO를 위한 핸즈프리/아이즈프리 영어 학습 앱입니다.
Gemini Multimodal Live API를 활용하여 실시간 음성 대화를 제공합니다.

## 기술 스택

- **Frontend**: React 18 + TypeScript + Vite 5
- **Audio**: Web Audio API (ScriptProcessorNode)
- **Network**: WebSocket (Gemini Multimodal Live API)
- **AI Model**: Gemini 2.0 Flash (`gemini-2.0-flash-exp`)
- **PWA**: Service Worker + Web App Manifest

## 프로젝트 구조

```
src/
├── main.tsx                    # 앱 엔트리 포인트
├── App.tsx                     # 메인 앱 컴포넌트 (상태 관리)
├── components/
│   ├── ParticleCanvas.tsx      # Canvas 기반 파티클 애니메이션
│   ├── StatusIndicator.tsx     # 연결/음성 상태 표시
│   ├── ControlButton.tsx       # 녹음 시작/중지 버튼
│   ├── ApiKeyInput.tsx         # Gemini API 키 입력 UI
│   ├── TranscriptOverlay.tsx   # AI 응답 텍스트 표시
│   └── index.ts                # 컴포넌트 barrel export
├── services/
│   ├── AudioService.ts         # Web Audio API 래퍼 (마이크/스피커)
│   └── GeminiService.ts        # WebSocket 클라이언트
├── hooks/
│   ├── useAudio.ts             # 오디오 상태 관리 훅
│   └── useGemini.ts            # Gemini 연결 상태 관리 훅
├── types/
│   └── index.ts                # TypeScript 타입 정의 및 상수
└── styles/
    └── global.css              # 글로벌 CSS 변수 및 스타일
```

## 핵심 아키텍처

### 1. 오디오 처리 파이프라인

```
마이크 → MediaStream → ScriptProcessorNode → PCM16 변환 → Base64 인코딩 → WebSocket 전송
                                                                              ↓
스피커 ← AudioBuffer ← Float32 변환 ← PCM16 디코딩 ← Base64 디코딩 ← WebSocket 수신
```

- **입력**: 16kHz, Mono, PCM16 (Gemini 요구 사항)
- **출력**: 24kHz, Mono, PCM16 (Gemini 응답 형식)

### 2. WebSocket 프로토콜 (Gemini Multimodal Live API)

1. **Setup 메시지**: 모델, 음성 설정, 시스템 프롬프트 전송
2. **Realtime Input**: 오디오 청크를 `media_chunks`로 스트리밍
3. **Server Content**: AI 응답 (텍스트 + 오디오) 수신

### 3. 상태 머신

```
VoiceState: idle → listening → processing → speaking → idle
                                    ↓
                                  error
```

- **idle**: 대기 중 (파란색 파티클)
- **listening**: 마이크 활성화 (초록색 파티클, 진폭 반응)
- **processing**: AI 처리 중 (노란색 파티클)
- **speaking**: AI 응답 재생 중 (보라색 파티클)
- **error**: 오류 발생 (빨간색 파티클)

## 주요 상수 (`src/types/index.ts`)

```typescript
GEMINI_WS_URL: 'wss://generativelanguage.googleapis.com/ws/...'
GEMINI_MODEL: 'gemini-2.0-flash-exp'
INPUT_SAMPLE_RATE: 16000   // 마이크 입력
OUTPUT_SAMPLE_RATE: 24000  // 스피커 출력
BUFFER_SIZE: 4096          // 오디오 버퍼
PARTICLE_COUNT: 60         // 파티클 개수
```

## 개발 가이드라인

### 코드 스타일

- TypeScript strict 모드 사용
- 함수형 컴포넌트 + React Hooks 패턴
- 싱글톤 서비스 패턴 (`audioService`, `geminiService`)
- 한글 주석 허용 (타겟 사용자가 한국인)

### 브라우저 호환성

- **필수**: Safari iOS 17+, Chrome 최신
- Web Audio API: `webkitAudioContext` 폴백 포함
- iOS Safari에서 `AudioContext.resume()` 필수

### 보안 주의사항

- API 키는 `localStorage`에만 저장 (외부 전송 없음)
- HTTPS 필수 (마이크 접근 정책)
- API 키를 git에 커밋하지 말 것

## 실행 방법

```bash
# 의존성 설치
npm install

# 개발 서버 (http://localhost:3000)
npm run dev

# 프로덕션 빌드
npm run build

# 빌드 미리보기
npm run preview
```

## PWA 설치 (iOS)

1. Safari에서 앱 URL 접속
2. 공유 버튼 → "홈 화면에 추가"
3. 전체화면 앱으로 실행됨

## 트러블슈팅

### 마이크 권한 오류

- HTTPS 환경에서만 `getUserMedia` 사용 가능
- 개발 시 `localhost`는 예외

### iOS 오디오 자동재생 차단

- 사용자 제스처(탭) 후 `AudioContext.resume()` 호출
- `ControlButton` 클릭 시 자동으로 처리됨

### WebSocket 연결 실패

- API 키 확인
- 네트워크 상태 확인
- 자동 재연결 로직 (최대 5회, 지수 백오프)

## 향후 개선 사항

- [ ] AudioWorklet 마이그레이션 (ScriptProcessorNode deprecated)
- [ ] VAD(Voice Activity Detection) 구현
- [ ] 차량 충전 감지 자동 실행 (iOS Shortcuts 연동)
- [ ] 오프라인 모드 지원
- [ ] 대화 히스토리 저장

## 라이선스

© 2024 AntiGravity Project. Powered by Gemini.
